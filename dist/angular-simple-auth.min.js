"use strict";angular.module("simpleAuth",["LocalStorageModule","base64"]).provider("simpleAuth",function(){angular.module("LocalStorageModule").value("prefix","auth-module");var a,b=this,c="/",d="/",e="SimpleAuth";this.redirectAfterLogout=function(a){return c=a,b},this.redirectAfterLogin=function(a){return d=a,b},this.authorizationName=function(a){return e=a,b},this.getToken=function(c){return a=c,b},this.$get=["localStorageService","$location",function(b,f){var g,h=function(){var a=b.get("last-login");return null!==a},i=function(c,e){return a(c,e).then(function(a){b.set("auth-token",a[0]),a.length>1&&angular.forEach(a[1],function(a,c){b.set(c,a)}),f.path(angular.isDefined(g)?g:d),g=void 0})},j=function(a){b.clearAll(),(angular.isUndefined(a)||angular.isUndefined(a.redirect)||a.redirect===!0)&&f.path(c)},k=function(){null===b.get("last-login")&&b.set("last-login",Date.now())},l=function(){h()||b.clearAll()},m=function(){b.clearAll(),g=f.path(),f.path("/login")},n=function(){return b.get("auth-token")},o=function(){return e},p=function(a,c){b.set(a,c)},q=function(a,c){var d=b.get(a);return angular.isDefined(c)&&null===d?c:d};return h()||b.clearAll(),{login:i,logout:j,setLastLogin:k,checkSessionValidity:l,requestLogin:m,getStoredToken:n,getAuthorizationName:o,isLoggedIn:h,putParam:p,getParam:q}}]}).factory("simpleAuthHttpInterceptor",["$q","simpleAuth",function(a,b){var c=!1;return{request:function(d){var e=b.getStoredToken();return c=null!==e,c&&(d.headers.Authorization=b.getAuthorizationName()+" "+e),d||a.when(d)},response:function(d){return c&&b.setLastLogin(),b.checkSessionValidity(),d||a.when(d)},responseError:function(c){return 401===c.status&&b.requestLogin(),a.reject(c)}}}]).controller("SimpleAuthLoginCtrl",["simpleAuth","$scope",function(a,b){b.login=function(){b.hasLoginError=!1,a.login(b.username,b.password).catch(function(){b.hasLoginError=!0}).finally(function(){b.$apply()})}}]).controller("SimpleAuthLogoutCtrl",["simpleAuth",function(a){a.logout()}]).directive("showIfAuth",["$animate","simpleAuth",function(a,b){return function(c,d){c.$watch(function(){return b.isLoggedIn()},function(){a[b.isLoggedIn()?"removeClass":"addClass"](d,"ng-hide")})}}]).config(["$httpProvider","$routeProvider",function(a,b){a.interceptors.push("simpleAuthHttpInterceptor"),b.when("/login",{templateUrl:"views/login.html",controller:"SimpleAuthLoginCtrl"}).when("/logout",{template:"Logging out...",controller:"SimpleAuthLogoutCtrl"})}]);